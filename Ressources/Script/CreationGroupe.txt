####################################################################################################
#                                                                                                  #
#   Création des groupes AD automatiquement à partir d'un fichier CSV avec protection contre la     #
#   suppression accidentelle et attribution à une OU spécifiée                                       #
#                                                                                                  #
####################################################################################################
### Paramètre(s) à modifier
$File = "$FilePath\ListGroup.txt"
### Initialisation
$FilePath = [System.IO.Path]::GetDirectoryName($MyInvocation.MyCommand.Definition)
$DomainDN = (Get-ADDomain).DistinguishedName
### Fonction pour créer des groupes AD
function CreateGroup
{
    param (
        [Parameter(Mandatory=$True, Position=0)][String]$GroupName,
        [Parameter(Mandatory=$True, Position=1)][String]$OUSecondaire,
        [Parameter(Mandatory=$True, Position=2)][String]$OUPrincipal
    )
# Chemin complet où le groupe sera créé si il n'existe pas
$DNSearchBase = "OU=$OUSecondaire,OU=$OUPrincipal,$DomainDN"
# Vérification si le groupe existe dans le chemin complet
$ExistingGroup = Get-ADGroup -Filter {Name -eq $GroupName} -SearchBase $DNSearchBase
if ($ExistingGroup) {
    Write-Host "Le groupe '$GroupName' existe déjà dans '$DNSearchBase'."  -ForegroundColor Red
} else {
# Si le groupe n'existe pas, le créer dans le chemin complet
    New-ADGroup -Name $GroupName -Path $DNSearchBase -GroupScope Global -PassThru
    Write-Host "Le groupe '$GroupName' a été créé dans '$DNSearchBase'."  -ForegroundColor Green
}
}
### Vérifier si le module ActiveDirectory est chargé, sinon l'importer
If (-not(Get-Module -Name activedirectory))
{
    Import-Module activedirectory
}
### Importer les données du fichier CSV
$Groups = Import-Csv -Path $File -Delimiter ";" -Header "GroupName", "OUSecondaire", "OUPrincipal"
### Créer les groupes à partir des données du CSV
Foreach ($Group in $Groups)
{
    CreateGroup -GroupName $Group.GroupName -OUSecondaire $Group.OUSecondaire -OUPrincipal $Group.OUPrincipal
}
